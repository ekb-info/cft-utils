#!/bin/sh

CONFIG_FILE='/etc/cft/cft.conf'

if [ "${1}" = '--config' -o "${1}" = '-c' ]; then
  CONFIG_FILE="${2}"
  [ "${CONFIG_FILE#/}" = "${CONFIG_FILE}" ] && CONFIG_FILE="/etc/cft/${CONFIG_FILE}"
  [ -e "${CONFIG_FILE}" ] || CONFIG_FILE="${CONFIG_FILE%.conf}.conf"
  shift 2
fi

if [ "${1}" = '-i' ]; then
	INPLACE=yes
	shift
fi

FILE="${1}"

if [ -z "${FILE}" ]; then
	echo "USAGE: ${0##*/} [-i] <file>"
	echo '-i   inplace copy'
	exit
fi

source "${CONFIG_FILE}" || exit 1

[ "${INPLACE}" = 'yes' ] && DEST="${FILE}" || DEST='./'

scp ${CFT_OPTS} -p -P "${CFT_PORT}" "${CFT_HOST}":"${CFT_ROOT}${CFT_ROOT:+/}${FILE}" "${DEST}"
